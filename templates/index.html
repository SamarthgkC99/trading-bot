<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UT Bot Trading Dashboard - Risk Management</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Your existing CSS stays unchanged -->
</head>
<body>

<!-- ===== UI CONTENT (UNCHANGED) ===== -->
<!-- Your full existing HTML layout remains exactly the same -->

<script>
/* =========================
   FIX: API BASE (IMPORTANT)
   ========================= */
const API_BASE = window.location.origin;

/* =========================
   Trading Control Functions
   ========================= */

async function startTrading() {
    const response = await fetch(`${API_BASE}/trading-control`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "start" })
    });
    const data = await response.json();
    updateTradingStatusUI(data);
}

async function stopTrading() {
    const response = await fetch(`${API_BASE}/trading-control`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "stop" })
    });
    const data = await response.json();
    updateTradingStatusUI(data);
}

async function forceStartTrading() {
    const response = await fetch(`${API_BASE}/trading-control`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "force_start" })
    });
    const data = await response.json();
    updateTradingStatusUI(data);
}

async function forceStopTrading() {
    const response = await fetch(`${API_BASE}/trading-control`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ action: "force_stop" })
    });
    const data = await response.json();
    updateTradingStatusUI(data);
}

/* =========================
   Trading Status UI Update
   ========================= */

async function updateTradingStatusUI(serverData = null) {
    let data = serverData;
    if (!data) {
        const response = await fetch(`${API_BASE}/trading-control`);
        data = await response.json();
    }

    document.getElementById("trading-status").innerText =
        data.trading_enabled ? "RUNNING" : "STOPPED";

    document.getElementById("trading-hours").innerText =
        `Trading Hours: ${data.start_time} - ${data.end_time} | Current: ${data.current_time}`;
}

/* =========================
   Chart Data Refresh
   ========================= */

async function refreshChart() {
    try {
        const response = await fetch(`${API_BASE}/chart-data`);
        if (!response.ok) throw new Error("Chart data not available");

        const data = await response.json();
        console.log("Chart Data:", data);

        document.getElementById("last-updated").innerText =
            "Last Updated: " + new Date().toLocaleTimeString();

    } catch (err) {
        document.getElementById("last-updated").innerText = "Last Updated: Error";
        console.error(err);
    }
}

/* =========================
   Auto Refresh
   ========================= */

setInterval(() => {
    updateTradingStatusUI();
    refreshChart();
}, 5000);

</script>

</body>
</html>
